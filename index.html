<!DOCTYPE html>
<html>
<head>
  <title>Cox Punch</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      max-width: 1000px;
      margin: auto;
      background-color: #f8f8f8;
      display: flex;
      flex-direction: row;
      gap: 2rem;
    }
    .main {
      flex: 2;
    }
    .sidebar {
      flex: 1;
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      font-size: 0.9rem;
    }
    h1 {
      text-align: center;
    }
    input, select, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    .result {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #fff;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.3rem;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="main">
  <h1>ðŸ¥Š Cox Punch</h1>

  <label for="raceType">Race type:</label><br>
  <select id="raceType">
    <option value="5k">5K</option>
    <option value="10k">10K</option>
    <option value="mile">Mile</option>
    <option value="half">Half Marathon</option>
  </select><br>

  <label for="timeInput">Time (mm:ss):</label><br>
  <input type="text" id="timeInput" placeholder="e.g. 17:02"><br>
  <button onclick="generateWorkout()">Generate Workout</button>

  <div class="result" id="result" style="display:none;"></div>
</div>

<div class="sidebar">
  <h3>Your VDOT Training Paces</h3>
  <div id="paceChart">Enter a time to see pace chart</div>
</div>

<script>
  const metersLookup = {
    "100": 100,
    "200": 200,
    "400": 400,
    "600": 600,
    "800": 800,
    "1000": 1000,
    "1200": 1200,
    "mile": 1609
  };

  const paces = ["400 pace", "800 pace", "1600 pace", "3k pace", "5k pace", "10k pace", "HMP", "MP", "all out"];
  const distances = ["100", "200", "400", "600", "800", "1000", "1200", "mile"];

  // Daniels lookup table (VDOT â‰ˆ input time based on race)
  function estimateVDOT(minutes, seconds, type) {
    const totalSec = minutes * 60 + seconds;
    const time = totalSec;
    let vdot;

    if (type === "5k") {
      if (time <= 900) return 68;
      if (time >= 1500) return 35;
      vdot = 83.5 - 0.0365 * time; // calibrated to Daniels
    } else if (type === "10k") {
      if (time <= 1900) return 68;
      if (time >= 3000) return 35;
      vdot = 81.0 - 0.0275 * time;
    } else if (type === "mile") {
      if (time <= 240) return 68;
      if (time >= 600) return 35;
      vdot = 93 - 0.066 * time;
    } else if (type === "half") {
      if (time <= 3600) return 68;
      if (time >= 7200) return 35;
      vdot = 73 - 0.0082 * time;
    }

    return Math.round(vdot);
  }

  function paceToMinSecPerMile(perK) {
    const perMile = perK * 1.609;
    const totalSec = Math.round(perMile * 60);
    const min = Math.floor(totalSec / 60);
    const sec = totalSec % 60;
    return `${min}:${sec.toString().padStart(2, '0')}`;
  }

  const paceChart = {
    "400 pace": { 68: 3.70, 60: 4.00, 55: 4.30, 50: 4.60, 45: 5.00, 40: 5.30, 35: 5.60 },
    "800 pace": { 68: 3.80, 60: 4.20, 55: 4.50, 50: 4.80, 45: 5.10, 40: 5.50, 35: 6.00 },
    "1600 pace": { 68: 4.00, 60: 4.40, 55: 4.80, 50: 5.20, 45: 5.60, 40: 6.00, 35: 6.40 },
    "3k pace": { 68: 4.20, 60: 4.60, 55: 5.00, 50: 5.40, 45: 5.80, 40: 6.20, 35: 6.60 },
    "5k pace": { 68: 4.40, 60: 4.80, 55: 5.20, 50: 5.60, 45: 6.00, 40: 6.40, 35: 6.80 },
    "10k pace": { 68: 4.55, 60: 5.00, 55: 5.45, 50: 6.00, 45: 6.45, 40: 7.00, 35: 7.45 },
    "HMP": { 68: 4.70, 60: 5.20, 55: 5.65, 50: 6.10, 45: 6.55, 40: 7.10, 35: 7.65 },
    "MP": { 68: 4.90, 60: 5.40, 55: 5.90, 50: 6.40, 45: 6.90, 40: 7.40, 35: 7.90 }
  };

  function getPaceSeconds(vdot, paceType, meters) {
    const level = [68, 60, 55, 50, 45, 40, 35].find(v => vdot >= v) || 35;
    const perK = paceChart[paceType][level] || 5.5;
    return perK * (meters / 1000) * 60;
  }

  function formatTime(sec) {
    const min = Math.floor(sec / 60);
    const s = Math.round(sec % 60);
    return `${min}:${s.toString().padStart(2, '0')}`;
  }

  function showPaceChart(vdot) {
    const level = [68, 60, 55, 50, 45, 40, 35].find(v => vdot >= v) || 35;
    let html = `<table><tr><th>Pace</th><th>min/mile</th></tr>`;
    for (const pace in paceChart) {
      const val = paceToMinSecPerMile(paceChart[pace][level]);
      html += `<tr><td>${pace}</td><td>${val}</td></tr>`;
    }
    html += "</table>";
    document.getElementById("paceChart").innerHTML = html;
  }

  function weightedRepCount(meters) {
    const options = [1, 2, 3, 4];
    const weights = [0.5, 0.25, 0.15, 0.10];
    for (let i = 3; i >= 0; i--) {
      if (meters * options[i] <= 1609) {
        if (Math.random() < weights[i]) return options[i];
      }
    }
    return 1;
  }

  function generateWorkout() {
    const type = document.getElementById("raceType").value;
    const input = document.getElementById("timeInput").value.trim();
    const match = input.match(/^(\d+):(\d{1,2})$/);
    if (!match) return alert("Enter time in mm:ss format");

    const min = parseInt(match[1]);
    const sec = parseInt(match[2]);
    const vdot = estimateVDOT(min, sec, type);
    showPaceChart(vdot);

    let dist = distances[Math.floor(Math.random() * distances.length)];
    let meters = metersLookup[dist];
    let reps = 1;
    let pace;

    if (dist === "100") {
      reps = 4;
      pace = "all out";
    } else if (dist === "200") {
      const allowed = ["all out", "400 pace"];
      pace = allowed[Math.floor(Math.random() * allowed.length)];
      reps = weightedRepCount(meters);
    } else {
      const validPaces = paces.filter(p => p !== "all out" && paceChart[p]);
      pace = validPaces[Math.floor(Math.random() * validPaces.length)];
      reps = weightedRepCount(meters);
    }

    const target = pace === "all out" ? "100% effort" : formatTime(getPaceSeconds(vdot, pace, meters));

    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `
      <h2>Today's Workout</h2>
      <p><strong>Distance:</strong> ${dist} Ã— ${reps}</p>
      <p><strong>Pace:</strong> ${pace}</p>
      <p><strong>Target Time per Rep:</strong> ${target}</p>
      <p><em>Based on your ${type.toUpperCase()} time of ${min}:${sec
        .toString()
        .padStart(2, "0")} (VDOT â‰ˆ ${vdot})</em></p>
    `;
  }
</script>
</body>
</html>
