<!DOCTYPE html>
<html>
<head>
  <title>Cox Punch</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
      background-color: #f8f8f8;
      display: flex;
      flex-direction: row;
      gap: 2rem;
    }
    .main {
      flex: 2;
    }
    .sidebar {
      flex: 1;
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      font-size: 0.9rem;
    }
    h1 {
      text-align: center;
    }
    input, select, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    .result {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #fff;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.3rem;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="main">
  <h1>üçä Cox Punch</h1>

  <label for="timeInput">Enter your recent 5K time (mm:ss):</label><br>
  <input type="text" id="timeInput" placeholder="e.g. 20:30"><br>

  <button id="generateBtn">Generate Workout</button>

  <div class="result" id="result" style="display:none;"></div>
</div>

<div class="sidebar">
  <h3>Your VDOT Training Paces</h3>
  <div id="paceChart">Enter a time to see pace chart</div>
</div>

<script>
  const distances = ["100", "200", "400", "600", "800", "1000", "1200", "mile", "strides"];
  const paces = ["3k pace", "5k pace", "10k pace", "HMP", "MP"];

  const paceMapping = {
    "3k pace": 2,
    "5k pace": 3,
    "10k pace": 4,
    "HMP": 5,
    "MP": 6
  };

  const distanceMapping = {
    "100": 0,
    "200": 0,
    "400": 1,
    "600": 2,
    "800": 3,
    "1000": 4,
    "1200": 5,
    "mile": 6
  };

  const metersLookup = {
    "100": 100,
    "200": 200,
    "400": 400,
    "600": 600,
    "800": 800,
    "1000": 1000,
    "1200": 1200,
    "mile": 1609
  };

  const vdotTable = [
    { vdot: 65, time: "16:30" },
    { vdot: 64, time: "16:41" },
    { vdot: 63, time: "16:52" },
    { vdot: 62, time: "17:03" },
    { vdot: 61, time: "17:14" },
    { vdot: 60, time: "17:25" },
    { vdot: 59, time: "17:36" },
    { vdot: 58, time: "17:48" },
    { vdot: 57, time: "17:59" },
    { vdot: 56, time: "18:10" },
    { vdot: 55, time: "18:21" },
    { vdot: 54, time: "18:33" },
    { vdot: 53, time: "18:44" },
    { vdot: 52, time: "18:56" },
    { vdot: 51, time: "19:07" },
    { vdot: 50, time: "19:19" },
    { vdot: 49, time: "19:31" },
    { vdot: 48, time: "19:43" },
    { vdot: 47, time: "19:55" },
    { vdot: 46, time: "20:07" },
    { vdot: 45, time: "20:19" }
  ];

  const paceChart = {
    "3k pace": { 65: "4:41", 60: "4:59", 55: "5:20", 50: "5:41", 45: "6:03" },
    "5k pace": { 65: "4:55", 60: "5:13", 55: "5:34", 50: "5:55", 45: "6:17" },
    "10k pace": { 65: "5:05", 60: "5:24", 55: "5:46", 50: "6:08", 45: "6:31" },
    "HMP": { 65: "5:15", 60: "5:35", 55: "5:58", 50: "6:22", 45: "6:45" },
    "MP": { 65: "5:35", 60: "5:56", 55: "6:20", 50: "6:45", 45: "7:10" }
  };

  function estimateVDOT(minutes, seconds) {
    const timeSec = minutes * 60 + seconds;
    for (let i = 0; i < vdotTable.length; i++) {
      const [min, sec] = vdotTable[i].time.split(":".map(Number));
      const compSec = parseInt(min) * 60 + parseInt(sec);
      if (timeSec <= compSec) return vdotTable[i].vdot;
    }
    return 45;
  }

  function showPaceChart(vdot) {
    let html = "<table><tr><th>Pace</th><th>min/mi</th></tr>";
    for (let pace in paceChart) {
      html += `<tr><td>${pace}</td><td>${paceChart[pace][vdot] || "--"}</td></tr>`;
    }
    html += "</table>";
    document.getElementById("paceChart").innerHTML = html;
  }

  function chooseRepCount(metersPerRep) {
    const reps = [1, 2, 3, 4];
    const weights = [0.5, 0.25, 0.15, 0.10];
    let filtered = reps.filter((r, i) => r * metersPerRep <= 1609);
    let totalWeight = filtered.reduce((sum, r, i) => sum + weights[i], 0);
    let rnd = Math.random() * totalWeight;
    for (let i = 0; i < filtered.length; i++) {
      if (rnd < weights[i]) return filtered[i];
      rnd -= weights[i];
    }
    return 1;
  }

  function generateWorkout() {
    const input = document.getElementById("timeInput").value.trim();
    const match = input.match(/^(\d+):(\d{1,2})$/);
    if (!match) return alert("Enter time in mm:ss format");

    const minutes = parseInt(match[1]);
    const seconds = parseInt(match[2]);
    const vdot = estimateVDOT(minutes, seconds);
    showPaceChart(vdot);

    const availableDistances = ["100", "200", "400", "600", "800", "1000", "1200", "mile", "strides"];
    const dist = availableDistances[Math.floor(Math.random() * availableDistances.length)];

    let output = `<h2>Today's Workout</h2>`;

    if (dist === "100") {
      output += `<p><strong>Distance:</strong> 100m √ó 4</p>`;
      output += `<p><strong>Pace:</strong> All out</p>`;
    } else if (dist === "strides") {
      output += `<p><strong>Workout:</strong> 6 strides at max effort</p>`;
    } else {
      const index = distanceMapping[dist];
      const validPaces = paces.filter(p => paceMapping[p] >= index + 2);
      const paceType = validPaces[Math.floor(Math.random() * validPaces.length)];
      const meters = metersLookup[dist];
      const reps = chooseRepCount(meters);
      const paceStr = paceChart[paceType][vdot] || "--";
      output += `<p><strong>Distance:</strong> ${dist} √ó ${reps}</p>`;
      output += `<p><strong>Pace:</strong> ${paceType}</p>`;
      output += `<p><strong>Target Pace:</strong> ${paceStr} per mile</p>`;
    }

    output += `<p><em>VDOT ~${vdot} based on your 5K time of ${minutes}:${seconds.toString().padStart(2, '0')}</em></p>`;
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = output;
  }

  document.getElementById("generateBtn").addEventListener("click", generateWorkout);
</script>

</body>
</html>
