<!DOCTYPE html>
<html>
<head>
  <title>Cox Punch</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
      background-color: #f8f8f8;
      display: flex;
      flex-direction: row;
      gap: 2rem;
    }
    .main {
      flex: 2;
    }
    .sidebar {
      flex: 1;
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      font-size: 0.9rem;
    }
    h1 {
      text-align: center;
    }
    input, select, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    .result {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #fff;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.3rem;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="main">
  <h1>üçä Cox Punch</h1>

  <label for="timeInput">Enter your recent 5K time (mm:ss):</label><br>
  <input type="text" id="timeInput" placeholder="e.g. 20:30"><br>

  <button id="generateBtn">Generate Workout</button>

  <div class="result" id="result" style="display:none;"></div>
</div>

<div class="sidebar">
  <h3>Your VDOT Punch Paces</h3>
  <div id="paceChart">Enter a time to see pace chart</div>
</div>

<script>
  const distances = ["100", "200", "400", "600", "800", "1000", "1200", "mile", "strides"];
  const paces = ["800m pace", "mile pace", "3k pace", "5k Punch Pace", "10k Punch Pace", "HMP", "MP"];

  const paceMapping = {
    "800m pace": 0,
    "mile pace": 1,
    "3k pace": 2,
    "5k Punch Pace": 3,
    "10k Punch Pace": 4,
    "HMP": 5,
    "MP": 6
  };

  const distanceMapping = {
    "100": 0,
    "200": 0,
    "400": 1,
    "600": 2,
    "800": 3,
    "1000": 4,
    "1200": 5,
    "mile": 6
  };

  const metersLookup = {
    "100": 100,
    "200": 200,
    "400": 400,
    "600": 600,
    "800": 800,
    "1000": 1000,
    "1200": 1200,
    "mile": 1609
  };

  const paceChart = {
    "800m pace": {
      65: "4:32", 64: "4:35", 63: "4:39", 62: "4:43", 61: "4:47", 60: "4:50",
      59: "4:54", 58: "4:58", 57: "5:02", 56: "5:06", 55: "5:10", 54: "5:14",
      53: "5:19", 52: "5:24", 51: "5:29", 50: "5:34", 49: "5:39", 48: "5:44",
      47: "5:49", 46: "5:54", 45: "6:00"
    },
    "mile pace": {
      65: "4:55", 64: "4:58", 63: "5:02", 62: "5:06", 61: "5:10", 60: "5:14",
      59: "5:18", 58: "5:23", 57: "5:27", 56: "5:31", 55: "5:36", 54: "5:41",
      53: "5:46", 52: "5:51", 51: "5:56", 50: "6:01", 49: "6:06", 48: "6:11",
      47: "6:16", 46: "6:21", 45: "6:26"
    },
    "3k pace": {
      65: "5:09", 64: "5:12", 63: "5:16", 62: "5:20", 61: "5:24", 60: "5:29",
      59: "5:33", 58: "5:38", 57: "5:43", 56: "5:48", 55: "5:53", 54: "5:58",
      53: "6:03", 52: "6:08", 51: "6:13", 50: "6:19", 49: "6:25", 48: "6:31",
      47: "6:37", 46: "6:43", 45: "6:49"
    },
    "5k Punch Pace": {
      65: "5:23", 64: "5:26", 63: "5:30", 62: "5:34", 61: "5:38", 60: "5:43",
      59: "5:47", 58: "5:52", 57: "5:57", 56: "6:02", 55: "6:07", 54: "6:12",
      53: "6:17", 52: "6:22", 51: "6:27", 50: "6:33", 49: "6:39", 48: "6:45",
      47: "6:51", 46: "6:57", 45: "7:03"
    },
    "10k Punch Pace": {
      65: "5:36", 64: "5:39", 63: "5:43", 62: "5:47", 61: "5:52", 60: "5:56",
      59: "6:01", 58: "6:06", 57: "6:11", 56: "6:16", 55: "6:21", 54: "6:26",
      53: "6:32", 52: "6:38", 51: "6:44", 50: "6:50", 49: "6:56", 48: "7:02",
      47: "7:08", 46: "7:14", 45: "7:20"
    },
    "HMP": {
      65: "5:50", 64: "5:54", 63: "5:59", 62: "6:04", 61: "6:09", 60: "6:14",
      59: "6:19", 58: "6:25", 57: "6:31", 56: "6:37", 55: "6:43", 54: "6:49",
      53: "6:55", 52: "7:01", 51: "7:07", 50: "7:13", 49: "7:19", 48: "7:25",
      47: "7:31", 46: "7:37", 45: "7:43"
    },
    "MP": {
      65: "6:07", 64: "6:11", 63: "6:16", 62: "6:21", 61: "6:26", 60: "6:31",
      59: "6:37", 58: "6:43", 57: "6:49", 56: "6:55", 55: "7:01", 54: "7:07",
      53: "7:13", 52: "7:19", 51: "7:25", 50: "7:31", 49: "7:37", 48: "7:43",
      47: "7:49", 46: "7:55", 45: "8:01"
    }
  };

  function estimateVDOT(minutes, seconds) {
    const timeSec = minutes * 60 + seconds;
    const vdotTable = [
      { time: "15:45", vdot: 65 }, { time: "16:00", vdot: 64 }, { time: "16:15", vdot: 63 },
      { time: "16:30", vdot: 62 }, { time: "16:45", vdot: 61 }, { time: "17:00", vdot: 60 },
      { time: "17:15", vdot: 59 }, { time: "17:30", vdot: 58 }, { time: "17:45", vdot: 57 },
      { time: "18:00", vdot: 56 }, { time: "18:15", vdot: 55 }, { time: "18:30", vdot: 54 },
      { time: "18:45", vdot: 53 }, { time: "19:00", vdot: 52 }, { time: "19:15", vdot: 51 },
      { time: "19:30", vdot: 50 }, { time: "19:45", vdot: 49 }, { time: "20:00", vdot: 48 },
      { time: "20:15", vdot: 47 }, { time: "20:30", vdot: 46 }, { time: "20:45", vdot: 45 }
    ];
    for (let i = 0; i < vdotTable.length; i++) {
      const [min, sec] = vdotTable[i].time.split(":" ).map(Number);
      const compSec = min * 60 + sec;
      if (timeSec <= compSec) return vdotTable[i].vdot;
    }
    return 45;
  }

  function showPaceChart(vdot) {
    let html = "<table><tr><th>Pace</th><th>min/mi</th></tr>";
    for (let pace in paceChart) {
      html += `<tr><td>${pace}</td><td>${paceChart[pace][vdot] || "--"}</td></tr>`;
    }
    html += "</table>";
    document.getElementById("paceChart").innerHTML = html;
  }

  function chooseRepCount(metersPerRep) {
    const reps = [1, 2, 3, 4];
    const weights = [0.5, 0.25, 0.15, 0.10];
    let filtered = reps.filter((r, i) => r * metersPerRep <= 1609);
    let totalWeight = filtered.reduce((sum, r, i) => sum + weights[i], 0);
    let rnd = Math.random() * totalWeight;
    for (let i = 0; i < filtered.length; i++) {
      if (rnd < weights[i]) return filtered[i];
      rnd -= weights[i];
    }
    return 1;
  }

  function generateWorkout() {
    const input = document.getElementById("timeInput").value.trim();
    const match = input.match(/^(\d+):(\d{1,2})$/);
    if (!match) return alert("Enter time in mm:ss format");

    const minutes = parseInt(match[1]);
    const seconds = parseInt(match[2]);
    const vdot = estimateVDOT(minutes, seconds);
    showPaceChart(vdot);

    const dist = distances[Math.floor(Math.random() * distances.length)];
    let output = `<h2>Today's Workout</h2>`;

    if (dist === "100") {
      output += `<p><strong>Distance:</strong> 100m √ó 4</p>`;
      output += `<p><strong>Pace:</strong> All out</p>`;
    } else if (dist === "strides") {
      output += `<p><strong>Workout:</strong> 6 strides at max effort</p>`;
    } else {
      const index = distanceMapping[dist];
      const validPaces = paces.filter(p => paceMapping[p] >= index + 2);
      const paceType = validPaces[Math.floor(Math.random() * validPaces.length)];
      const meters = metersLookup[dist];
      const reps = chooseRepCount(meters);
      const paceStr = paceChart[paceType]?.[vdot] || "--";
      output += `<p><strong>Distance:</strong> ${dist} √ó ${reps}</p>`;
      output += `<p><strong>Pace:</strong> ${paceType}</p>`;
      output += `<p><strong>Target Pace:</strong> ${paceStr} per mile</p>`;
    }

    output += `<p><em>VDOT ~${vdot} based on your 5K time of ${minutes}:${seconds.toString().padStart(2, '0')}</em></p>`;
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = output;
  }

  document.getElementById("generateBtn").addEventListener("click", generateWorkout);
</script>

</body>
</html>
