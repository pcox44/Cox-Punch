<!DOCTYPE html>
<html>
<head>
  <title>Cox Punch</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
      background-color: #f8f8f8;
      display: flex;
      flex-direction: row;
      gap: 2rem;
    }
    .main {
      flex: 2;
    }
    .sidebar {
      flex: 1;
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      font-size: 0.9rem;
    }
    h1 {
      text-align: center;
    }
    input, select, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    .result {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #fff;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.3rem;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="main">
  <h1>üçä Cox Punch</h1>

  <label for="timeInput">Enter your recent 5K time (mm:ss):</label><br>
  <input type="text" id="timeInput" placeholder="e.g. 20:30"><br>

  <button id="generateBtn">Generate Workout</button>

  <div class="result" id="result" style="display:none;"></div>
</div>

<div class="sidebar">
  <h3>Your VDOT Punch Paces</h3>
  <div id="paceChart">Enter a time to see pace chart</div>
</div>

<script>
  const distances = ["100", "200", "400", "600", "800", "1000", "1200", "mile", "strides"];
  const paces = ["800m pace", "mile pace", "3k pace", "5k Punch Pace", "10k Punch Pace", "HMP", "MP"];

  const paceMapping = {
    "800m pace": 0,
    "mile pace": 1,
    "3k pace": 2,
    "5k Punch Pace": 3,
    "10k Punch Pace": 4,
    "HMP": 5,
    "MP": 6
  };

  const distanceMapping = {
    "100": 0,
    "200": 0,
    "400": 1,
    "600": 2,
    "800": 3,
    "1000": 4,
    "1200": 5,
    "mile": 6
  };

  const metersLookup = {
    "100": 100,
    "200": 200,
    "400": 400,
    "600": 600,
    "800": 800,
    "1000": 1000,
    "1200": 1200,
    "mile": 1609
  };

  const validVDOTs = [65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49, 48, 47, 46, 45];

  const paceChart = {};
  for (let pace of paces) paceChart[pace] = {};
  for (let v of validVDOTs) {
    paceChart["800m pace"][v] = "4:32";
    paceChart["mile pace"][v] = "4:48";
    paceChart["3k pace"][v] = "5:04";
    paceChart["5k Punch Pace"][v] = "5:19";
    paceChart["10k Punch Pace"][v] = "5:34";
    paceChart["HMP"][v] = "5:50";
    paceChart["MP"][v] = "6:06";
  }

  function estimateVDOT(minutes, seconds) {
    const timeSec = minutes * 60 + seconds;
    const vdotTable = [
      { time: "15:45", vdot: 65 }, { time: "16:00", vdot: 64 }, { time: "16:15", vdot: 63 },
      { time: "16:30", vdot: 62 }, { time: "16:45", vdot: 61 }, { time: "17:00", vdot: 60 },
      { time: "17:15", vdot: 59 }, { time: "17:30", vdot: 58 }, { time: "17:45", vdot: 57 },
      { time: "18:00", vdot: 56 }, { time: "18:15", vdot: 55 }, { time: "18:30", vdot: 54 },
      { time: "18:45", vdot: 53 }, { time: "19:00", vdot: 52 }, { time: "19:15", vdot: 51 },
      { time: "19:30", vdot: 50 }, { time: "19:45", vdot: 49 }, { time: "20:00", vdot: 48 },
      { time: "20:15", vdot: 47 }, { time: "20:30", vdot: 46 }, { time: "20:45", vdot: 45 }
    ];
    for (let i = 0; i < vdotTable.length; i++) {
      const [min, sec] = vdotTable[i].time.split(":" ).map(Number);
      const compSec = min * 60 + sec;
      if (timeSec <= compSec) return vdotTable[i].vdot;
    }
    return 45;
  }

  function showPaceChart(vdot) {
    let html = "<table><tr><th>Punch Pace</th><th>min/mi</th></tr>";
    for (let pace in paceChart) {
      html += `<tr><td>${pace}</td><td>${paceChart[pace][vdot] || "--"}</td></tr>`;
    }
    html += "</table>";
    document.getElementById("paceChart").innerHTML = html;
  }

  function chooseRepCount(metersPerRep) {
    const reps = [1, 2, 3, 4];
    const weights = [0.5, 0.25, 0.15, 0.10];
    let filtered = reps.filter((r, i) => r * metersPerRep <= 1609);
    let totalWeight = filtered.reduce((sum, r, i) => sum + weights[i], 0);
    let rnd = Math.random() * totalWeight;
    for (let i = 0; i < filtered.length; i++) {
      if (rnd < weights[i]) return filtered[i];
      rnd -= weights[i];
    }
    return 1;
  }

  function generateWorkout() {
    const input = document.getElementById("timeInput").value.trim();
    const match = input.match(/^(\d+):(\d{1,2})$/);
    if (!match) return alert("Enter time in mm:ss format");

    const minutes = parseInt(match[1]);
    const seconds = parseInt(match[2]);
    const vdot = estimateVDOT(minutes, seconds);
    showPaceChart(vdot);

    const dist = distances[Math.floor(Math.random() * distances.length)];
    let output = `<h2>Today's Workout</h2>`;

    if (dist === "100") {
      output += `<p><strong>Distance:</strong> 100m √ó 4</p>`;
      output += `<p><strong>Pace:</strong> All out</p>`;
    } else if (dist === "strides") {
      output += `<p><strong>Workout:</strong> 6 strides at max effort</p>`;
    } else {
      const index = distanceMapping[dist];
      let validPaces;

      if (dist === "1200" || dist === "mile") {
        validPaces = ["10k Punch Pace", "HMP", "MP"];
      } else {
        validPaces = paces.filter(p => paceMapping[p] >= index + 2);
      }

      const paceType = validPaces[Math.floor(Math.random() * validPaces.length)];
      const meters = metersLookup[dist];
      const reps = chooseRepCount(meters);
      const paceStr = paceChart[paceType]?.[vdot];
      output += `<p><strong>Distance:</strong> ${dist} √ó ${reps}</p>`;
      output += `<p><strong>Pace:</strong> ${paceType}</p>`;
      output += `<p><strong>Target Pace:</strong> ${paceStr || "--"} per mile</p>`;
    }

    output += `<p><em>VDOT ~${vdot} based on your 5K time of ${minutes}:${seconds.toString().padStart(2, '0')}</em></p>`;
    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = output;
  }

  document.getElementById("generateBtn").addEventListener("click", generateWorkout);
</script>

</body>
</html>
