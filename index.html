<!DOCTYPE html>
<html>
<head>
  <title>Cox Punch</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
      max-width: 900px;
      margin: auto;
      background-color: #f8f8f8;
      display: flex;
      flex-direction: row;
      gap: 2rem;
    }
    .main {
      flex: 2;
    }
    .sidebar {
      flex: 1;
      background: #fff;
      border: 1px solid #ccc;
      padding: 1rem;
      font-size: 0.9rem;
    }
    h1 {
      text-align: center;
    }
    input, select, button {
      padding: 0.5rem;
      font-size: 1rem;
      margin-top: 0.5rem;
    }
    .result {
      margin-top: 2rem;
      padding: 1rem;
      background-color: #fff;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 0.3rem;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="main">
  <h1>ðŸ¥Š Cox Punch</h1>

  <label for="raceType">Select race type:</label><br>
  <select id="raceType">
    <option value="5k">5K</option>
    <option value="10k">10K</option>
    <option value="mile">Mile</option>
    <option value="half">Half Marathon</option>
  </select><br>

  <label for="timeInput">Enter your recent race time (mm:ss):</label><br>
  <input type="text" id="timeInput" placeholder="e.g. 20:30"><br>

  <button onclick="generateWorkout()">Generate Workout</button>

  <div class="result" id="result" style="display:none;"></div>
</div>

<div class="sidebar">
  <h3>Your VDOT Training Paces</h3>
  <div id="paceChart">Enter a time to see pace chart</div>
</div>

<script>
  const distances = ["200", "400", "600", "800", "1000", "1200", "mile"];
  const paces = ["3k pace", "5k pace", "10k pace", "HMP", "MP"];

  const paceMapping = {
    "3k pace": 2,
    "5k pace": 3,
    "10k pace": 4,
    "HMP": 5,
    "MP": 6
  };

  const distanceMapping = {
    "200": 0,
    "400": 1,
    "600": 2,
    "800": 3,
    "1000": 4,
    "1200": 5,
    "mile": 6
  };

  const metersLookup = {
    "200": 200,
    "400": 400,
    "600": 600,
    "800": 800,
    "1000": 1000,
    "1200": 1200,
    "mile": 1609
  };

  // VDOT Estimates (simplified) for 5k, 10k, mile, half
  function estimateVDOT(timeMin, timeSec, raceType) {
    const totalMin = timeMin + timeSec / 60;
    let vdot;
    if (raceType === "5k") vdot = 85 - totalMin;
    else if (raceType === "10k") vdot = 90 - (totalMin / 2);
    else if (raceType === "mile") vdot = 105 - (totalMin * 3);
    else if (raceType === "half") vdot = 50 - (totalMin / 6);
    return Math.max(35, Math.round(vdot));
  }

  const paceChart = {
    "3k pace": { 65: 2.91, 60: 3.10, 55: 3.30, 50: 3.50, 45: 4.10, 40: 4.30, 35: 4.50 },
    "5k pace": { 65: 3.06, 60: 3.21, 55: 3.41, 50: 4.01, 45: 4.21, 40: 4.41, 35: 5.00 },
    "10k pace": { 65: 3.16, 60: 3.32, 55: 3.52, 50: 4.12, 45: 4.32, 40: 4.52, 35: 5.15 },
    "HMP": { 65: 3.25, 60: 3.42, 55: 4.02, 50: 4.22, 45: 4.42, 40: 5.00, 35: 5.25 },
    "MP": { 65: 3.45, 60: 4.00, 55: 4.20, 50: 4.40, 45: 5.00, 40: 5.20, 35: 5.45 }
  };

  function getTargetPaceSeconds(vdot, paceType, meters) {
    let level = [65, 60, 55, 50, 45, 40, 35].find(v => vdot >= v) || 35;
    const perK = paceChart[paceType][level] || 5.0;
    return perK * (meters / 1000) * 60;
  }

  function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.round(seconds % 60);
    return `${mins}:${secs.toString().padStart(2, '0')}`;
  }

  function chooseRepCount(metersPerRep) {
    const probs = [0.5, 0.25, 0.15, 0.10];
    const maxReps = [1, 2, 3, 4];
    for (let i = 3; i >= 0; i--) {
      const total = metersPerRep * maxReps[i];
      if (total <= 1609) {
        const roll = Math.random();
        if (roll < probs[i]) return maxReps[i];
      }
    }
    return 1;
  }

  function showPaceChart(vdot) {
    const level = [65, 60, 55, 50, 45, 40, 35].find(v => vdot >= v) || 35;
    let html = "<table><tr><th>Pace</th><th>min/km</th></tr>";
    for (let pace in paceChart) {
      const val = paceChart[pace][level];
      html += `<tr><td>${pace}</td><td>${val.toFixed(2)}</td></tr>`;
    }
    html += "</table>";
    document.getElementById("paceChart").innerHTML = html;
  }

  function generateWorkout() {
    const raceType = document.getElementById("raceType").value;
    const input = document.getElementById("timeInput").value.trim();
    const match = input.match(/^(\d+):(\d{1,2})$/);
    if (!match) return alert("Enter time in mm:ss format");

    const minutes = parseInt(match[1]);
    const seconds = parseInt(match[2]);
    const vdot = estimateVDOT(minutes, seconds, raceType);
    showPaceChart(vdot);

    let dist, paceType, meters, reps = 1;

    // Pick a distance
    let validDistances = distances.filter(d => {
      const index = distanceMapping[d];
      const validPaces = paces.filter(p => paceMapping[p] >= index + 2);
      return validPaces.length > 0;
    });
    dist = validDistances[Math.floor(Math.random() * validDistances.length)];
    meters = metersLookup[dist];

    // Pick a valid pace
    const validPaces = paces.filter(p => paceMapping[p] >= distanceMapping[dist] + 2);
    paceType = validPaces[Math.floor(Math.random() * validPaces.length)];

    reps = chooseRepCount(meters);
    const targetTime = getTargetPaceSeconds(vdot, paceType, meters);

    document.getElementById("result").style.display = "block";
    document.getElementById("result").innerHTML = `
      <h2>Today's Cox Punch</h2>
      <p><strong>Distance:</strong> ${dist} Ã— ${reps}</p>
      <p><strong>Pace:</strong> ${paceType}</p>
      <p><strong>Target Time per Rep:</strong> ${formatTime(targetTime)}</p>
      <p><em>VDOT ~${vdot} based on your ${raceType.toUpperCase()} time of ${minutes}:${seconds.toString().padStart(2, '0')}</em></p>
    `;
  }
</script>

</body>
</html>
